# OVDE CU OSTAVITI SAMO NEKE NEOPHODNE BELESKE, KOJE SE TICU SAMO MOZDA REDOSLEDA ONOGA STA SAM RADIO

PRE SVEGA DA KAZEM STA SAM ODLUCIO DA CU KORISTI U POGLEDU COOKIE-A, localStorage-A, ILI NECEG SLICNOG

## IPAK CU KORISTITI Authorization HEADER (SA bearer OPCIJOM) (**NIKAKO NECU KORISTI, NI COOKIES A NI localStorage**)

STO ZNACI KADA SE KORISNIK REGISTRUJE (TAD JE ON DAKLE LOGED IN), I KADA SE SUBSEQUENTLY ULOGUJE USPESNO, PAYLOAD DEO TOKENA CE MU BITI POSLAT, KOJI ON ONDA KORISTI ZA SVE NOVE REQUESTOVE

PAYLOAD DEO TOKENA MOGU RECI DA SE NIGDE NE SKLADISTI, DAKLE NIGDE SE NE CUVA NA CLIENTU

MOGU TO POSMATRATI OVAKO

- CLIENT SE ULOGOVAO I POSLAT MU JE NOVI VIEW, KOJ IJE ONAJ VIEW KOJI JE SERVED KADA JE NEKO AUTHENTICATED

- DEO TOG POSLATOG VIEW-A, ODNOSNO JAVASCRIPT, TOG DELA, A MOZE TO DA BUDE I HTML (OVO JE MENI PALO NA PAMET, ALI PROVERI DA LI JE DOBRA PRKSA), TREBA DA IMA BEARER TOKEN

- U CLIENT SIDE API-U, ODNOSO U REQUEST-OVIMA, KOJI SE SALJU, TAJ Authorization HEADER SA bearer TOKENOM CE BITI PODESEN

**POMENUTO CES VIDETI IZ CLIENT SIDE CODE-A**

## :one: PRVO KREIRAJ SCHEMA-U I MODEL

I TU CES TAKODJE KREITRATI I NEOPHODNE MONGOOSE VIRTUALE I MONGOOSE MIDDLEWARE HOOKS

ODNOSNO ONO ZA STA CU SE POSTARTAI JESTE DA PASSWORD BUDE HASHED, PRI POHRANJIVANJU ILI UPDATINGU, user DOKUMENTA

DAKLE IDEJA JE DA TI DEFINISES NORMALNE KONTROLERE, CIJA CE ULOGA BITI DA VRSE INTERAKCIU SA USER DOKUMENTIMA, ALI MONGOOSE MIDDLEWARE CE BITI ODGOVORAN

DA PRE NEGO STO SE DESI save ILI update DA SE PASSWORD SACUVA KAO HASHED

ZA HASHING KORISTIS PAKET bcrypt

I OPET [FLAVIO COPES IMA SJAJNO OBJASNJENJE VEZANO ZA bcrypt](https://flaviocopes.com/javascript-bcrypt/) _I ZA HSHING PASSWORD-A_

OSTALO SVE PROCITAJ IZ NJEGOVOG TUTORIJALA A ONO STO CU SAMO RECI **PASSWORD SE, AS A PLAIN TEXT NIKAD NE CUVA U DATBASE-U**

## :two: KREIRAJ KONTROLERE

**BITNA STVAR ZA NJIH JESTE, TO DA CE user OBJEKAT, ODNONO DOKUMENT, ONI UZIMATI SA REQUEST-A**

_A KO CE STAVITI USER OBJEKAT NA REQUEST OBJEKAT_

**TO CE BITI MIDDLEWARE** (A TO CE BITI protect MIDDLEWARE) (MIDDLEWARE KOJEG CU KASNIJE KREIRATI, A KOJI CE NA SVAKOM REQUESTU ZA API, USTVARI PROVERAVATI VALIDNOST JSON WEB TOKEN-A)

AKO OVAJ MIDDLEWARE NE URADI SVE ONO KAO KADA JE VALID KORISNIK TU, ONC CE IZVRSITI ONAJ DRUGI PAR, A KOJI SE ODNOSI NA PROTECTION, NECE SE ZAKACITI user OBJEKAT NA REQUEST, VEC CE KROZ next BITI PROSLEDJENE ERROR, KOJI GOVORI DA AUTORIZACIAJ NIJE BILA USPESNA

A TO ZNACI DA USER NECE BITI GETT-OVAN, I NECE MOCI BITI MOGUCI DALJI REQUEST-OVI

ALI protect MIDDLEWARE CU KASNIJE DEFINISATI, KAO DEO CELOG auth.ts FAJLA

- JEDAN KONTROLER TREBA DA UZME USER-A **SA REQUEST-A** (MIDDLEWARE TREBA DA GA ZAKACI ZA REQUEST (ONAJ MIDDLEWARE, KOJI PROTEC-UJE ROUTE, ODNSNO KOJI VALIDIRA JWT)); I ONDA TA JUSER OBJEKAT SE NAZAD SALJE KORINIKU

- DRUGI TREBA DA UPDATE-UJE USER OBJEKAT ISTO CE TO SMETI SAMO DA URADI AKO MOZE DA UZME user OBJEKT SA REQUEST-A

**OVO SU DAKLE KONTROLERI, KOJE CE KORISTITI user -OV ROUTER**

ONAJ STO GETUJE USER-A, CE TI SE UCINITI DA NEMA NIKAKAVOG EFEKTA, JER KAO DA UVEK RETURN-UJE USER-A

## :three: KREIRANJE USER ROUTERA

UZIMAM DAV POMENUTA KONTROLERA, ODNOSNO UVOZIM IH U user.router.ts FAJL

KACIM IH SAMO NA / KADA UPOTREBLJAVAM VERB-OVE NA ROUTE-RU

## :four: DEFINISEM /utils/auth.ts FAJL

U OVOM FAJLU CE SE NALAZITI I signIn I signUp FUNKCIJE, KAO I protect MIDDLEWARE

U TO MFAJLU DEFINISEM UPOTREBU JSON WEB TOKEN-A

NPAOMENA ZA signIn I signUp

> ONI CE BITI KONTROLERI post -A , UPRAVO U SERVER FAJLU

> ISTO TAKO I protect CE BITI MAOUNTED KAO MIDDLEWARE, U ISTOM FAJLU
