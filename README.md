# OVDE CU OSTAVITI SAMO NEKE NEOPHODNE BELESKE, KOJE SE TICU SAMO MOZDA REDOSLEDA ONOGA STA SAM RADIO

PRE SVEGA DA KAZEM STA SAM ODLUCIO DA CU KORISTI U POGLEDU COOKIE-A, localStorage-A, ILI NECEG SLICNOG

## IPAK CU KORISTITI Authorization HEADER (SA bearer OPCIJOM) (**NIKAKO NECU KORISTI, NI COOKIES A NI localStorage**)

STO ZNACI KADA SE KORISNIK REGISTRUJE (TAD JE ON DAKLE LOGED IN), I KADA SE SUBSEQUENTLY ULOGUJE USPESNO, TOKENA CE MU BITI POSLAT, KOJI ON ONDA KORISTI ZA SVE NOVE REQUESTOVE

ZA TOKEN MOGU RECI DA SE NIGDE NE SKLADISTI, DAKLE NIGDE SE NE CUVA NA CLIENTU

MOGU TO POSMATRATI OVAKO

- CLIENT SE ULOGOVAO I POSLAT MU JE NOVI VIEW, KOJ IJE ONAJ VIEW KOJI JE SERVED KADA JE NEKO AUTHENTICATED

- DEO TOG POSLATOG VIEW-A, ODNOSNO JAVASCRIPT, TOG DELA, A MOZE TO DA BUDE I HTML (OVO JE MENI PALO NA PAMET, ALI PROVERI DA LI JE DOBRA PRKSA), TREBA DA IMA BEARER TOKEN

- U CLIENT SIDE API-U, ODNOSO U REQUEST-OVIMA, KOJI SE SALJU, TAJ Authorization HEADER SA bearer TOKENOM CE BITI PODESEN

**POMENUTO CES VIDETI IZ CLIENT SIDE CODE-A**

## :one: PRVO KREIRAJ SCHEMA-U I MODEL

I TU CES TAKODJE KREITRATI I NEOPHODNE MONGOOSE VIRTUALE I MONGOOSE MIDDLEWARE HOOKS

ODNOSNO ONO ZA STA CU SE POSTARTAI JESTE DA PASSWORD BUDE HASHED, PRI POHRANJIVANJU ILI UPDATINGU, user DOKUMENTA

DAKLE IDEJA JE DA TI DEFINISES NORMALNE KONTROLERE, CIJA CE ULOGA BITI DA VRSE INTERAKCIU SA USER DOKUMENTIMA, ALI MONGOOSE MIDDLEWARE CE BITI ODGOVORAN

DA PRE NEGO STO SE DESI save ILI update DA SE PASSWORD SACUVA KAO HASHED

ZA HASHING KORISTIS PAKET bcrypt

I OPET [FLAVIO COPES IMA SJAJNO OBJASNJENJE VEZANO ZA bcrypt](https://flaviocopes.com/javascript-bcrypt/) _I ZA HSHING PASSWORD-A_

OSTALO SVE PROCITAJ IZ NJEGOVOG TUTORIJALA A ONO STO CU SAMO RECI **PASSWORD SE, AS A PLAIN TEXT NIKAD NE CUVA U DATBASE-U**

## :two: KREIRAJ KONTROLERE

**BITNA STVAR ZA NJIH JESTE, TO DA CE user OBJEKAT, ODNONO DOKUMENT, ONI UZIMATI SA REQUEST-A**

_A KO CE STAVITI USER OBJEKAT NA REQUEST OBJEKAT_

**TO CE BITI MIDDLEWARE** (A TO CE BITI protect MIDDLEWARE) (MIDDLEWARE KOJEG CU KASNIJE KREIRATI, A KOJI CE NA SVAKOM REQUESTU ZA API, USTVARI PROVERAVATI VALIDNOST JSON WEB TOKEN-A)

AKO OVAJ MIDDLEWARE NE URADI SVE ONO KAO KADA JE VALID KORISNIK TU, ONC CE IZVRSITI ONAJ DRUGI PAR, A KOJI SE ODNOSI NA PROTECTION, NECE SE ZAKACITI user OBJEKAT NA REQUEST, VEC CE KROZ next BITI PROSLEDJENE ERROR, KOJI GOVORI DA AUTORIZACIAJ NIJE BILA USPESNA

A TO ZNACI DA USER NECE BITI GETT-OVAN, I NECE MOCI BITI MOGUCI DALJI REQUEST-OVI

ALI protect MIDDLEWARE CU KASNIJE DEFINISATI, KAO DEO CELOG auth.ts FAJLA

- JEDAN KONTROLER TREBA DA UZME USER-A **SA REQUEST-A** (MIDDLEWARE TREBA DA GA ZAKACI ZA REQUEST (ONAJ MIDDLEWARE, KOJI PROTEC-UJE ROUTE, ODNSNO KOJI VALIDIRA JWT)); I ONDA TA JUSER OBJEKAT SE NAZAD SALJE KORINIKU

- DRUGI TREBA DA UPDATE-UJE USER OBJEKAT ISTO CE TO SMETI SAMO DA URADI AKO MOZE DA UZME user OBJEKT SA REQUEST-A

**OVO SU DAKLE KONTROLERI, KOJE CE KORISTITI user -OV ROUTER**

ONAJ STO GETUJE USER-A, CE TI SE UCINITI DA NEMA NIKAKAVOG EFEKTA, JER KAO DA UVEK RETURN-UJE USER-A

## :three: KREIRANJE USER ROUTERA

UZIMAM DAV POMENUTA KONTROLERA, ODNOSNO UVOZIM IH U user.router.ts FAJL

KACIM IH SAMO NA / KADA UPOTREBLJAVAM VERB-OVE NA ROUTE-RU

## :four: DEFINISACU utils/jwt.ts FAJL

KORISTIM **jsonwebtoken** PAKET, KOJI JE PO TOME KAKO SE UPOTREBLJAVA, JAKO SLICAN SA bcrypt

- KREIRACU FUNKCIJU, KOJA CE SLUZITI ZA KREIRANJE TOKENA

TOKEN CE BITI KREIRAN, NE OD CELOG USER OBJEKTA, VEC OD OBJEKTA, U KOJEM CE SAMO BITI ID KORISNIKA

NARAVNO POTREBAN TI JE I SECRET

- DRUGA FUNKCIJA KOJU CU KREIRATI TREBA DA UZME TOKEN I DA VALIDIRA TOKEN NA OSNOVU SECRET-A (DAKLE TE DVE STVARI TREBA DA ODGOVARAJU)

**KREIRANJE TOKENA JE SINHRONO ALI VERIFIKACIJA JE ASINHRONA**

CISTO DA SE PODSETIS TOKENA (OVO JE VAZNO AKO NISI RAZUMEO)

> CEO TOKEN SE SALJE IZMEDJU KORISNIKA I BACKENDA

> A VERIFIKACIJA TOKENA, SA SECRET-OM, ITOKENAOM KAO ARGUMENTIMA, TREBA DA PRODUCE-UJE PAYLOAD DEO TOKENA (OVO SE RADI ASINHRONO)

A ZNAM DA SE PAYLOA PRAVI OD OBJEKAT SA USER ID-JEM (TAKO BAR ZELIM DA GA NAPRAVIM) (AL IDA BI BIO SIGURNIJI, PAYLOAD SE MOZE SASTOJATI OD USER ID-AJ I OD NJEGOVOG MAIL-A)

## :five: DEFINISEM /utils/auth.ts FAJL

U OVAJ FAJL UVOZIM JSON WEB TOKEN FUNKCIJE, KOJE SAM KREIRAO U PREDHODNOM FAJLU (FUNKCIJA KOJA KREIRA I FUNKCIJA KOJA VERIFIKUJE JWT)

DAKLE U OVOM FAJLU CE SE NALAZITI I signIn I signUp FUNKCIJE, KAO I protect MIDDLEWARE

U TO MFAJLU DEFINISEM UPOTREBU JSON WEB TOKEN-A

NPAOMENA ZA signIn I signUp

> ONI CE BITI KONTROLERI post -A , UPRAVO U SERVER FAJLU (ZA SVOJA signin I signup ROUTE-OVE)

> ISTO TAKO I protect CE BITI MOUNTED KAO MIDDLEWARE, U ISTOM FAJLU

## :six: POSTO SI DEFINISAO signUp, signIn KONTROLERE I protect MIDDLEWARE, VREME JE DA IH UVEZES I ISKORISTIS U SVOM SERVERU (NARAVNO TAKODJE CES UVESTI I USER ROUTER, U KOJEM JE VEC DEFINISANO GETTING USER-A ILI BNJEGOV UPDATING)

---

**NARAVNO PRE OVOGA KREITAJ I FUNKCIJU KOJA KONEKTUJE NA DATBASE, JER TEK NAKON USPESNOG CONNECT-A, TREBA DA BUDE ZADAT LISTENING TVOG SERVER-A, NA ZELJENOM PORT-U**

**SVE STVARI KOJE KORISTIS KAO STO SU URL TVOG MONGO-A, ILI SERCRETS TREBAL OBI DA UVOZIS IZ CONFIG FAJLA (SECRETS IN env-JA PRVO BI TREBALE DA DODJU TAMO) (TO JE CISTO ZBOG MOGUCNOSTI DA U PROJEKTU IMAS I TESTING I DEVELOPMENT I PRODUCTION KONFIGURACIJU), ALI POSTO TI OVDE NEMAS TO, MOZES DA DEFINISES RECIMO DA IME DATBASE-A, DODAJES IZ ENVIROMENT-A** (OVO JE SAMO DEV KONFIGURACIJA TAK ODA NIJE BITNO, KORISTICES JEDAN JEDINI URL, JER KORISTIS ONAJ MONGO INSTALIRAN NA TVOJOJ KUCNOJ MASINI)

DAKLE U utility-JU PRVO KREIRAJ TAKVU FUNKCIJU PA SE ONDA BAVI SERVEROM

---

NARAVNO signIn I signUp CE IMATI THEIR OWN ENDPOINT-E

ALI protect MIDDLEWARE MORA DA STOJI KAO GATEKEEPER ISPRED SVAKOG NOVOG API KOJI SE BUDE KRIRAO, NARAVNO AKO ZELIM DA TE NOVE API-EVE SAMO SMEJU DA KORISTE SAMO AUTHENTICATED USERS

STO SE TICE USER ROUTER-A (SLUZI ZA GETTING USER-A I ZA UPDATING) (I ISPRED NJEGA TREBA DA LEZI MIDDLEWARE), NARAVNO, POGLEDAJ GA OPET AKO TI NIJE JASNO

I ON ZAVISI OD MIDDLEWARE-A, JER I KONTROLERI TOG ROUTER, UZIMAJU user-A SA REQUEST-A

## ENVIROMENT VARIABLES

- SECRET

- EXPIRATION

- DATBASE_NAME
